<!DOCTYPE html>
<html lang="pt-BR">
<head>
<style>
  body { font-family: "Inter", sans-serif; padding: 16px; color: #333; }
  h3 { margin-top: 0; font-size: 14px; }
  p { font-size: 11px; color: #666; margin-bottom: 8px; }
  
  textarea { 
    width: 100%; 
    height: 220px; 
    padding: 8px; 
    margin-bottom: 12px; 
    font-size: 10px; 
    font-family: monospace; 
    border: 1px solid #ddd;
    border-radius: 4px;
    resize: none;
  }
  
  button { 
    background: #18A0FB; 
    color: white; 
    border: none; 
    padding: 10px 16px; 
    border-radius: 6px; 
    font-weight: 600; 
    cursor: pointer; 
    width: 100%;
    transition: background 0.2s;
  }
  button:disabled { background: #ccc; cursor: not-allowed; }
  button:hover:not(:disabled) { background: #0D8CE0; }

  /* Área de Status */
  #status {
    margin-top: 12px;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 4px;
    font-size: 11px;
    display: none; /* Escondido por padrão */
    border-left: 3px solid #ccc;
  }
  .loading { border-color: #18A0FB !important; background: #eef7ff !important; color: #0066cc; }
  .error { border-color: #ff3333 !important; background: #fff0f0 !important; color: #cc0000; }
  .success { border-color: #00cc66 !important; background: #f0fff4 !important; color: #008844; }

</style>
</head>
<body>
  <h3>Importar JSON (Sem IA)</h3>
  <p>1. Rode o script do botão vermelho no Chrome.<br>2. Cole o JSON abaixo.</p>
  
  <textarea id="jsonInput" placeholder='Cole aqui o JSON gerado pelo botão vermelho...'></textarea>
  
  <button id="draw">Desenhar Layout</button>
  
  <div id="status">Aguardando...</div>

  <script>
    const btn = document.getElementById('draw');
    const input = document.getElementById('jsonInput');
    const statusEl = document.getElementById('status');

    function showStatus(msg, type) {
      statusEl.style.display = 'block';
      statusEl.className = type; // loading, error, success
      statusEl.textContent = msg;
      
      if (type === 'loading') btn.disabled = true;
      else btn.disabled = false;
    }

    // Escuta mensagens do code.js
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (msg.type === 'status') {
        showStatus(msg.text, msg.state);
      }
    };

    btn.onclick = () => {
      const jsonStr = input.value.trim();
      
      if (!jsonStr) {
        showStatus("A caixa de texto está vazia!", "error");
        return;
      }

      try {
        showStatus("Verificando JSON...", "loading");
        const data = JSON.parse(jsonStr);
        
        showStatus("Enviando para o Figma...", "loading");
        parent.postMessage({ pluginMessage: { type: 'draw-layout', data } }, '*');
        
      } catch(e) {
        showStatus("JSON Inválido. Certifique-se de ter copiado tudo.", "error");
        console.error(e);
      }
    }
  </script>
</body>
</html>